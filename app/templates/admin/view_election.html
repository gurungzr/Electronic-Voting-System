{% extends "base.html" %}

{% block title %}{{ stats.election.name }} - Admin - Online Voting Nepal{% endblock %}

{% block extra_css %}
<style>
    body {
        background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #252540 100%);
        min-height: 100vh;
    }
    .navbar {
        background: rgba(15, 15, 26, 0.95) !important;
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    footer {
        background: rgba(15, 15, 26, 0.95) !important;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
    }
    footer span {
        color: rgba(255, 255, 255, 0.5) !important;
    }

    /* Breadcrumb */
    .breadcrumb {
        background: transparent;
        padding: 0;
        margin: 0;
    }
    .breadcrumb-item a {
        color: #60a5fa;
        text-decoration: none;
    }
    .breadcrumb-item a:hover {
        color: #93c5fd;
    }
    .breadcrumb-item.active {
        color: rgba(255, 255, 255, 0.6);
    }
    .breadcrumb-item + .breadcrumb-item::before {
        color: rgba(255, 255, 255, 0.3);
    }

    /* Page header */
    .page-title {
        color: white;
        font-weight: 600;
    }
    .page-title i {
        color: #dc2626;
    }
    .text-muted {
        color: rgba(255, 255, 255, 0.5) !important;
    }

    /* Status badges */
    .badge-lg {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 500;
    }
    .badge-active {
        background: rgba(34, 197, 94, 0.2);
        color: #86efac;
    }
    .badge-upcoming {
        background: rgba(6, 182, 212, 0.2);
        color: #67e8f9;
    }
    .badge-ended {
        background: rgba(107, 114, 128, 0.3);
        color: #d1d5db;
    }

    /* Stat cards */
    .stat-card {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s ease;
    }
    .stat-card:hover {
        transform: translateY(-4px);
        border-color: rgba(255, 255, 255, 0.15);
    }
    .stat-card h3 {
        color: white;
        font-size: 2rem;
        font-weight: 700;
        margin: 0;
    }
    .stat-card p {
        color: rgba(255, 255, 255, 0.6);
        margin: 0.5rem 0 0 0;
        font-size: 0.9rem;
    }
    .stat-card.primary { border-left: 4px solid #3b82f6; }
    .stat-card.info { border-left: 4px solid #06b6d4; }
    .stat-card.success { border-left: 4px solid #22c55e; }
    .stat-card.secondary { border-left: 4px solid #6b7280; }
    .stat-card.dark { border-left: 4px solid #475569; }
    .stat-card.warning { border-left: 4px solid #eab308; }

    /* Info cards */
    .info-card {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        overflow: hidden;
    }
    .info-card .card-header {
        background: rgba(255, 255, 255, 0.05);
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        padding: 1rem 1.25rem;
    }
    .info-card .card-header h5 {
        color: white;
        margin: 0;
        font-weight: 600;
    }
    .info-card .card-header h5 i {
        color: #dc2626;
    }
    .info-card .card-body {
        padding: 1.25rem;
    }

    /* Detail rows styling */
    .detail-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.875rem 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }
    .detail-row:last-child {
        border-bottom: none;
    }
    .detail-label {
        color: rgba(255, 255, 255, 0.5);
        font-weight: 500;
        font-size: 0.9rem;
    }
    .detail-value {
        color: rgba(255, 255, 255, 0.9);
        font-weight: 500;
        text-align: right;
    }
    .detail-value code {
        background: rgba(220, 38, 38, 0.15);
        color: #fca5a5;
        padding: 0.3rem 0.6rem;
        border-radius: 6px;
        font-size: 0.85rem;
    }
    .text-success { color: #86efac !important; }
    .text-danger { color: #fca5a5 !important; }
    .text-info { color: #67e8f9 !important; }
    .text-secondary { color: #9ca3af !important; }

    /* List group */
    .candidate-list {
        background: transparent;
    }
    .candidate-list .list-group-item {
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 10px !important;
        margin-bottom: 0.5rem;
        padding: 1rem;
        color: white;
    }
    .candidate-list .list-group-item strong {
        color: white;
    }
    .candidate-list .list-group-item small {
        color: rgba(255, 255, 255, 0.5);
    }
    .candidate-list .badge {
        background: rgba(107, 114, 128, 0.3);
        color: #d1d5db;
    }

    /* Buttons */
    .btn-back {
        color: rgba(255, 255, 255, 0.7);
        border-color: rgba(255, 255, 255, 0.2);
        background: transparent;
    }
    .btn-back:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.3);
        color: white;
    }
    .btn-warning-custom {
        background: linear-gradient(135deg, #eab308 0%, #ca8a04 100%);
        border: none;
        color: #1a1a2e;
        font-weight: 600;
    }
    .btn-warning-custom:hover {
        background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
        color: #1a1a2e;
    }
    .btn-success-custom {
        background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        border: none;
        color: white;
        font-weight: 600;
    }
    .btn-success-custom:hover {
        background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
    }

    /* Modal */
    .modal-content {
        background: #1a1a2e;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
    }
    .modal-header {
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .modal-header.bg-warning {
        background: linear-gradient(135deg, #eab308 0%, #ca8a04 100%) !important;
    }
    .modal-header .modal-title {
        color: #1a1a2e;
        font-weight: 600;
    }
    .modal-body {
        color: rgba(255, 255, 255, 0.8);
    }
    .modal-body ul {
        color: rgba(255, 255, 255, 0.7);
    }
    .modal-footer {
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
    }
    .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.15);
        color: white;
    }

    /* Animation */
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .stat-card { animation: fadeInUp 0.4s ease-out backwards; }
    .stat-card:nth-child(1) { animation-delay: 0.1s; }
    .stat-card:nth-child(2) { animation-delay: 0.15s; }
    .stat-card:nth-child(3) { animation-delay: 0.2s; }
    .info-card { animation: fadeInUp 0.5s ease-out 0.3s backwards; }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('admin.dashboard') }}">Dashboard</a></li>
                <li class="breadcrumb-item active">{{ stats.election.name }}</li>
            </ol>
        </nav>
    </div>
</div>

<div class="row mb-4">
    <div class="col">
        <div class="d-flex justify-content-between align-items-center">
            <h2 class="page-title"><i class="bi bi-calendar-event me-2"></i>{{ stats.election.name }}</h2>
            {% if stats.status == 'ongoing' %}
                <span class="badge-lg badge-active">Active</span>
            {% elif stats.status == 'upcoming' %}
                <span class="badge-lg badge-upcoming">Upcoming</span>
            {% else %}
                <span class="badge-lg badge-ended">Ended</span>
            {% endif %}
        </div>
        <p class="text-muted">{{ stats.election.description }}</p>
    </div>
</div>

<!-- Statistics -->
<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="stat-card primary h-100">
            <h3>{{ stats.total_pr_votes }}</h3>
            <p>Votes Cast</p>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="stat-card info h-100">
            <h3>{{ stats.registered_voters }}</h3>
            <p>Registered Voters</p>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="stat-card success h-100">
            <h3>{{ stats.participation_rate }}%</h3>
            <p>Participation Rate</p>
        </div>
    </div>
</div>

<!-- Token Statistics -->
<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="stat-card secondary h-100">
            <h3>{{ stats.tokens_issued }}</h3>
            <p>Tokens Issued</p>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="stat-card dark h-100">
            <h3>{{ stats.tokens_fully_used }}</h3>
            <p>Tokens Used</p>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="stat-card warning h-100">
            <h3>{{ stats.tokens_pending }}</h3>
            <p>Tokens Pending</p>
        </div>
    </div>
</div>

<!-- Election Details -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="info-card h-100">
            <div class="card-header">
                <h5><i class="bi bi-info-circle me-2"></i>Election Details</h5>
            </div>
            <div class="card-body">
                <div class="detail-row">
                    <span class="detail-label">Election ID</span>
                    <span class="detail-value"><code>{{ stats.election.election_id }}</code></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Start Date</span>
                    <span class="detail-value">{{ stats.election.start_date.strftime('%B %d, %Y at %H:%M') }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">End Date</span>
                    <span class="detail-value">{{ stats.election.end_date.strftime('%B %d, %Y at %H:%M') }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Status</span>
                    <span class="detail-value">
                        {% if not stats.election.is_active %}
                            <span class="text-danger"><i class="bi bi-x-circle-fill me-1"></i>Deactivated</span>
                        {% elif stats.status == 'ongoing' %}
                            <span class="text-success"><i class="bi bi-broadcast me-1"></i>Ongoing</span>
                        {% elif stats.status == 'upcoming' %}
                            <span class="text-info"><i class="bi bi-clock-fill me-1"></i>Upcoming</span>
                        {% else %}
                            <span class="text-secondary"><i class="bi bi-check-circle-fill me-1"></i>Ended</span>
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="info-card h-100">
            <div class="card-header">
                <h5><i class="bi bi-people me-2"></i>Candidates</h5>
            </div>
            <div class="card-body">
                <ul class="list-group candidate-list">
                    {% for candidate in stats.election.candidates %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ candidate.name }}</strong>
                            <br><small>{{ candidate.party }}</small>
                        </div>
                        <span class="badge">{{ candidate.candidate_id[:8] }}...</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Actions -->
<div class="row">
    <div class="col">
        <a href="{{ url_for('admin.dashboard') }}" class="btn btn-back">
            <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
        </a>

        {% if stats.status == 'ongoing' %}
        <!-- Terminate Election Button (for demo purposes) -->
        <button type="button" class="btn btn-warning-custom" data-bs-toggle="modal" data-bs-target="#terminateModal">
            <i class="bi bi-stop-circle me-2"></i>Terminate Election
        </button>
        {% endif %}

        {% if stats.status == 'ended' %}
        <a href="{{ url_for('admin.election_results', election_id=stats.election.election_id) }}"
           class="btn btn-success-custom">
            <i class="bi bi-bar-chart me-2"></i>View Results
        </a>
        {% endif %}
    </div>
</div>

{% if stats.status == 'ongoing' %}
<!-- Terminate Confirmation Modal -->
<div class="modal fade" id="terminateModal" tabindex="-1" aria-labelledby="terminateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title" id="terminateModalLabel">
                    <i class="bi bi-exclamation-triangle me-2"></i>Terminate Election
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to terminate this election immediately?</p>
                <ul>
                    <li>No more votes will be accepted</li>
                    <li>Results can be viewed after entering decryption shares</li>
                    <li>This action cannot be undone</li>
                </ul>
                <p class="text-muted mb-0">
                    <small>Use this for demonstration purposes to view results without waiting for the scheduled end time.</small>
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form action="{{ url_for('admin.terminate_election', election_id=stats.election.election_id) }}" method="POST" style="display: inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-warning">
                        <i class="bi bi-stop-circle me-2"></i>Terminate Now
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
